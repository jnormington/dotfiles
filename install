#!/bin/bash

DOTFILES_REPO="https://github.com/jnormington/dotfiles"
DOTFILES=$HOME/.dotfiles

# Assume debian based os for now
sudo add-apt-repository ppa:git-core/ppa -y
sudo apt-get update
sudo apt-get install -y git curl wget vim unzip zeal

# Install Vundle for vim
echo "Install Vundle"
git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim

echo "Install dotfiles"
# Ensure the dotfiles directory exists
git clone $DOTFILES_REPO $DOTFILES

# Move the files/directories in dotfiles into position
for conf in $(ls $DOTFILES)
do
  case "$conf" in
    README.md)
      ;;
    install)
      ;;

    ssh_config)
      mkdir -p $HOME/.ssh
      [ ! -e $HOME/.ssh/config ] && ln -s $DOTFILES/$conf $HOME/.ssh/config
      echo "Linked: ssh_config"
      ;;

    i3)
      if [[ $(uname) == "Linux" ]]; then
        mkdir -p $HOME/.config/i3
        ln -sf $DOTFILES/i3/config $HOME/.config/i3/config
        echo "Linked: i3 config"
        ln -sf $DOTFILES/i3/i3blocks.conf $HOME/.i3blocks.conf
        echo "Linked: i3 blocks config"
      fi
      ;;

    ftplugin)
      mkdir ~/.vim/after
      ln -sf $DOTFILES/$conf ~/.vim/after/ftplugin
      ;;

    gitconfig)
     sed 's?%HOME_PATH%?'"$HOME"'?' $conf > $HOME/.gitconfig
      ;;

    helpers)
      # Let bash_alias will source from dotfiles directly
      ;;

    *)
      dest=$HOME/.$conf
      echo "Linked: $dest"
      ln -sf $DOTFILES/$conf $dest
  esac
done

echo "Running commands in vim"
vim +PluginInstall +qall +GoInstallBinaries
